name: Daily Autonomous Conversation

on:
  schedule:
    # Uruchom codziennie o 18:00 UTC (19:00 CET)
    - cron: '0 18 * * *'
  
  # MoÅ¼liwoÅ›Ä‡ manualnego uruchomienia
  workflow_dispatch:

permissions:
  contents: write

jobs:
  autonomous-conversation:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ğŸ“¦ Install dependencies
        run: |
          pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
      
      - name: ğŸ¤– Run autonomous conversation
        env:
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
        run: |
          echo "ğŸ¤– Starting autonomous conversation - $(date '+%Y-%m-%d %H:%M')"
          python autonomous_conversation_engine.py
      
      - name: ğŸ“Š Extract conversation summary
        run: |
          echo "Extracting last conversation summary..."
          python -c "import json; convs = json.load(open('autonomous_conversations.json', 'r', encoding='utf-8')); last = convs[-1] if convs else None; print('ID: ' + str(last.get('id', 'N/A')) + '\nTopic: ' + str(last.get('topic_name', 'N/A')) + '\nMessages: ' + str(len(last.get('messages', []))) if last else 'No conversations')" > conversation_summary.txt
          cat conversation_summary.txt
      
      - name: ğŸ’¾ Commit conversation
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # Dodaj pliki z rozmowÄ…
          git add autonomous_conversations.json api_usage.json
          
          # Commit tylko jeÅ›li sÄ… zmiany
          git diff --staged --quiet || git commit -m "ğŸ¤– Daily autonomous conversation: $(date '+%Y-%m-%d')" \
            -m "Automated conversation between AI partners" \
            -m "$(cat conversation_summary.txt)"
      
      - name: ğŸš€ Push changes
        uses: ad-m/github-push-action@v0.8.0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ github.ref }}
      
      - name: âœ… Conversation complete
        run: |
          echo "âœ… Daily autonomous conversation completed!"
          echo "ğŸ“ Check autonomous_conversations.json for details"

# UWAGA: Ten workflow jest OPCJONALNY
# Kosztuje API calls kaÅ¼dego dnia
# MoÅ¼esz go wyÅ‚Ä…czyÄ‡ usuwajÄ…c sekcjÄ™ 'schedule'
# i uruchamiaÄ‡ tylko manualnie (workflow_dispatch)
